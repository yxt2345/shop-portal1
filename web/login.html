<!DOCTYPE html>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <title>飞狐商城-欢迎登录</title>
    <link rel="icon" href="https://www.itfh.com/favicon.ico">
    <link type="text/css" rel="stylesheet" href="css/login.css">
    <script src="js/jquery-3.3.1.js"></script>
    <script src="js/common.js"></script>
    <script src="js/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/shop/js/pages/index.js"></script>
    <body>
        <div class="w">
            <div id="logo">
                <a href="https://www.itfh.com/">
                    <img src="images/logo.png" alt="飞狐商城" width="170" height="60">
                </a>
                <b></b>
            </div>
        </div>
        <div id="content">
            <div class="tips-wrapper">
                <div class="tips-inner">
                    <div class="cont-wrapper"><i class="icon-tips"></i>
                        <p>依据《网络安全法》，为保障您的账户安全和正常使用，请尽快完成手机号验证！ 新版<a href="#" class="black"
                         target="_blank">《飞狐商城隐私政策》</a>已上线，将更有利于保护您的个人隐私。
                        </p>
                    </div>
                </div>
            </div>
            <div class="login-wrap">
                <div class="w">
                    <div class="login-form">
                        <div class="tips-wrapper">
                            <div class="tips-inner">
                                <div class="cont-wrapper"><i class="icon-tips"></i>
                                    <p>飞狐商城不会以任何理由要求您转账汇款，谨防诈骗。</p></div>
                            </div>
                        </div>
                        <div class="login-tab login-tab-l">
                            <a href="javascript:void(0)" class="checked" style="outline: rgb(109, 109, 109) none 0px;">账户登录</a>
                        </div>
                        <div class="login-box" style="display: block; visibility: visible;">
                            <div class="mt tab-h">
                            </div>
                            <div class="msg-wrap">
                                <div class="msg-error hide"><b></b></div>
                            </div>
                            <div class="mc">
                                <div class="form">
                                    <form id="formlogin" method="post" onsubmit="return false;">
                                        <div class="item item-fore1">
                                            <label for="username" class="login-label name-label"></label>
                                            <input id="username" type="text" class="itxt" name="loginname" tabindex="1"
                                                   autocomplete="off" value="" placeholder="邮箱/用户名/登录手机">
                                            <span class="clear-btn"></span>
                                        </div>

                                        <div id="entry" class="item item-fore2" style="visibility: visible;">
                                            <label class="login-label pwd-label" for="password"></label>
                                            <input type="password" id="password" name="nloginpwd" class="itxt itxt-error"
                                                   tabindex="2" autocomplete="off" placeholder="密码">
                                            <span class="clear-btn"></span>
                                            <span class="capslock" style="display: none;"><b></b>大小写锁定已打开</span>
                                        </div>


                                        <div id="o-authcode" class="item item-vcode item-fore3">
                                            <input id="code" type="text" class="itxt itxt02" name="authcode" tabindex="3">
                                            <img id="checkCodeImg" onclick="changeCheckCode()" src="http://localhost:2222/CheckCodeServlet" class="verify-code">
                                            <a href="javascript:void(0)" onclick="changeCheckCode()">看不清换一张</a>
                                        </div>

                                        <div class="item item-fore4">
                                            <div class="safe">
                                                <span></span>
                                                <span class="forget-pw-safe">
                                                    <a href="#" class="" target="_blank">忘记密码</a>
                                                </span>
                                            </div>
                                        </div>

                                        <div class="item item-fore5">
                                            <div class="login-btn">
                                                <a href="javascript:;" class="btn-img btn-entry" id="loginsubmit" onclick="login()" tabindex="6">登&nbsp;&nbsp;&nbsp;&nbsp;录</a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>


                        <div class="coagent" id="kbCoagent">
                            <ul>
                                <li class="extra-r">
                                    <div>
                                        <div class="regist-link">
                                            <a href="#" target="_blank" onclick="register()"><b></b>立即注册</a>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="login-banner" style="background:#af000e">
                    <div class="w">
                        <div id="banner-bg" class="i-inner"
                             style="background: url(images/aaa.jpg) 0px 0px no-repeat;background-color: #1f0068"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="w">
            <div id="footer-2013">
                <div class="links">
                    <a rel="nofollow" target="_blank" href="#">
                        关于我们
                    </a>
                    |
                    <a rel="nofollow" target="_blank" href="#">
                        联系我们
                    </a>
                    |
                    <a rel="nofollow" target="_blank" href="#">
                        人才招聘
                    </a>
                    |
                    <a rel="nofollow" target="_blank" href="#">
                        商家入驻
                    </a>
                    |
                    <a rel="nofollow" target="_blank" href="#">
                        广告服务
                    </a>
                    |
                    <a rel="nofollow" target="_blank" href="#">
                        手机飞狐
                    </a>
                    |
                    <a target="_blank" href="#">
                        友情链接
                    </a>
                    |
                    <a target="_blank" href="#">
                        销售联盟
                    </a>
                    |
                    <a href="#" target="_blank">
                        飞狐社区
                    </a>
                    |
                    <a href="#" target="_blank">
                        飞狐公益
                    </a>
                    |
                    <a target="_blank" href="#">English Site</a>
                </div>
                <div class="copyright">
                    Copyright&nbsp;&#169;&nbsp;2017-2019&nbsp;&nbsp;飞狐商城itfh.com&nbsp;版权所有
                </div>
            </div>
        </div>
    </body>

    <script>

        function changeCheckCode(){
            //通过改变验证码图片的src属性值就可以刷新验证码
            //因为浏览器对url的结果有缓存，咱们可以在url后面拼接一个随机参数解决这个问题
            //$("#checkCodeImg").attr("src","http://localhost:2222/CheckCodeServlet?sdsdf=" + new Date().getTime());
            $("#checkCodeImg").attr("src","http://localhost:2222/CheckCodeServlet?sdsdf=" + Math.random());
        }

        function login(){
            //获取用户名
            var username = $("#username").val().trim();
            //获取密码
            var password = $("#password").val().trim();

            var code = $("#code").val().trim();
            //发起一个ajax请求调用注册会员的API接口
            $.ajax({
                url:"http://localhost:2222/member/login",
                type:"post",
                data:{
                    loginname:username,
                    password:password,
                    code:code
                },
                dataType:"json",

                success:function(result){
                    if(result.code == 200){
                        alert("登录成功!");
                        localStorage.setItem("token",result.data);
                        location.href = "index.html";
                    }else{
                        alert(result.message);
                    }
                },
                error:function(){
                    alert("登录失败!");
                }
            });
        }

        function register(){
            //获取用户名
            var username = $("#username").val().trim();
            //获取密码
            var password = $("#password").val().trim();
            //获取确认密码
            var confirmPassword = $("#confirmPassword").val().trim();
            //获取手机号
            var phoneNumber = $("#phoneNumber").val().trim();
            //获取验证码
            var code = $("#code").val().trim();

            if(username == ""){
                alert("用户名不能为空");
                return;
            }

            if(password == ""){
                alert("密码不能为空!");
                return;
            }

            if(password != confirmPassword){
                alert("密码输入不一致!");
                return;
            }

            //获取手机号
            var phoneNumber = $("#phoneNumber").val().trim();
            if(phoneNumber == ""){
                alert("手机号不能为空!");
                return;
            }

            var phoneNumberReg = /^1\d{10}$/;
            if(!phoneNumberReg.test(phoneNumber)){
                alert("手机号不合法!");
                return;
            }

            if(code == ""){
                alert("验证码不能为空!");
                return;
            }

            //发起一个ajax请求调用注册会员的API接口
            $.ajax({
                url:"http://localhost:2222/member/register",
                type:"post",
                data:{
                    username:username,
                    password:password,
                    phoneNumber:phoneNumber,
                    code:code
                },
                dataType:"json",
                success:function(result){
                    if(result.code == 200){
                        alert("恭喜您注册成功!");

                        location.href = "login.html";
                    }else{
                        alert(result.message);
                    }
                },
                error:function(){
                    alert("注册失败!");
                }
            });
        }

    </script>

</html>